{{- /* ✅ Final stable version – Structured Data cho phiên bản MOBILE */ -}}
{{- $base := .Site.Params.mobileDomain | default "https://albumgaixinh-mobile.netlify.app/" -}}

{{- if not (.Page.Scratch.Get "schema_rendered") -}}
  {{- .Page.Scratch.Set "schema_rendered" true -}}

  {{/* ========== HOME PAGE ========== */}}
  {{- if .IsHome -}}
    {{- $schema := dict
        "@context" "https://schema.org"
        "@type" "WebSite"
        "url" $base
        "name" (.Site.Title | default "Album Gái Xinh (Mobile)")
        "description" (.Site.Params.description | default "Phiên bản mobile chính thức của Album Gái Xinh – giao diện nhanh, nhẹ, thân thiện điện thoại.")
        "publisher" (dict "@type" "Organization" "name" "Album Gái Xinh" "url" $base
          "logo" (dict "@type" "ImageObject" "url" (print $base "images/logo.png")) )
      -}}
    <script type="application/ld+json">{{ $schema | jsonify | safeJS }}</script>
  {{- end -}}

  {{/* ========== SECTION PAGE ========== */}}
  {{- if and .IsSection (not .IsHome) -}}
    {{- $title := .Title | default "Album Gái Xinh" -}}
    {{- $desc  := .Description | default "Khám phá bộ sưu tập ảnh gái xinh, hot girl – bản mobile tối ưu tốc độ." -}}
    {{- $img   := "images/cover.jpg" | absURL -}}

    {{- $albums := slice -}}
    {{- range first 20 .RegularPages -}}
      {{- $thumb := "" -}}
      {{- with .Params.thumbs }}{{ $thumb = index . 0 }}{{ else }}{{ with .Params.images }}{{ $thumb = index . 0 }}{{ else }}{{ $thumb = ("images/cover.jpg" | absURL) }}{{ end }}{{ end }}
      {{- $albums = $albums | append (dict "@type" "ImageObject" "name" .Title "url" .Permalink "image" $thumb) -}}
    {{- end -}}

    {{- $schema := dict
        "@context" "https://schema.org"
        "@type" "CollectionPage"
        "@id" (print .Permalink "#collection")
        "name" $title
        "description" $desc
        "url" .Permalink
        "image" $img
        "hasPart" $albums
        "publisher" (dict "@type" "Organization" "name" "Album Gái Xinh"
          "logo" (dict "@type" "ImageObject" "url" (print $base "images/logo.png")))
      -}}
    <script type="application/ld+json">{{ $schema | jsonify | safeJS }}</script>
  {{- end -}}

  {{/* ========== SINGLE PAGE (ALBUM DETAIL) ========== */}}
  {{- if and .IsPage (not .IsHome) -}}
    {{- $title := .Title | default "Album Gái Xinh" -}}
    {{- $desc  := .Description | default "Tuyển tập ảnh hot girl, người mẫu và gái xinh – phiên bản mobile tối ưu hiển thị." -}}
    {{- $img := "" -}}
    {{- if .Params.images -}}
      {{- $img = index .Params.images 0 -}}
    {{- else if .Params.thumbs -}}
      {{- $img = index .Params.thumbs 0 -}}
    {{- else -}}
      {{- $img = ("images/cover.jpg" | absURL) -}}
    {{- end -}}

    {{- $media := slice -}}
    {{- with .Params.images -}}
      {{- range . -}}
        {{- $media = $media | append (dict "@type" "ImageObject" "url" . "caption" $title) -}}
      {{- end -}}
    {{- end -}}

    {{- $schema := dict
        "@context" "https://schema.org"
        "@type" (slice "Article" "ImageGallery")
        "@id" (print .Permalink "#article")
        "headline" $title
        "description" $desc
        "url" .Permalink
        "image" $img
        "associatedMedia" $media
        "publisher" (dict "@type" "Organization" "name" "Album Gái Xinh"
          "logo" (dict "@type" "ImageObject" "url" (print $base "images/logo.png")))
        "author" (dict "@type" "Person" "name" (.Params.author | default "Admin"))
        "datePublished" ((or .Date now).Format "2006-01-02T15:04:05+07:00")
        "dateModified" ((or .Lastmod now).Format "2006-01-02T15:04:05+07:00")
      -}}
    <script type="application/ld+json">{{ $schema | jsonify | safeJS }}</script>
  {{- end -}}

  {{/* ========== BREADCRUMB ========== */}}
  {{- $items := slice (dict "@type" "ListItem" "position" 1 "name" "Trang chủ" "item" $base) -}}
  {{- if .IsSection -}}
    {{- $items = $items | append (dict "@type" "ListItem" "position" 2 "name" (.Title | default "Album Gái Xinh") "item" .Permalink) -}}
  {{- else if .IsPage -}}
    {{- $secPerm := "" -}}
    {{- with site.GetPage .Section -}}
      {{- $secPerm = .Permalink -}}
    {{- else -}}
      {{- $secPerm = (print $base .Section "/") -}}
    {{- end -}}
    {{- $items = $items | append (dict "@type" "ListItem" "position" 2 "name" (.Section | default "Ảnh Gái Xinh") "item" $secPerm) -}}
    {{- $items = $items | append (dict "@type" "ListItem" "position" 3 "name" (.Title | default "Album Gái Xinh") "item" .Permalink) -}}
  {{- end -}}

  {{- $breadcrumb := dict
      "@context" "https://schema.org"
      "@type" "BreadcrumbList"
      "itemListElement" $items
    -}}
  <script type="application/ld+json">{{ $breadcrumb | jsonify | safeJS }}</script>

{{- end -}}
